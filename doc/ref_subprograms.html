<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/transitional.dtd">
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="description" CONTENT="SparForte language documentation">
tion">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>SparForte - Reference - Block Statements and Subprograms</title>
	<link rel="StyleSheet" type="text/css" media="screen" href="art/sparforte.css">
</head>
<body bgcolor="#FFFFFF"><a name="top"></a>
	<table width="100%" cellspacing="0" cellpadding="0" summary="page layout">
		<tr><td align="left"><img src="art/sparforte.png" alt="[SparForte]"></td><td align="right"><img src="art/header_cloud.png" alt="[Banner]"></td></tr>
		<tr><td background="art/header_border.png" height="10" colspan="2"></td></tr>
		<tr><td colspan="2"><table width="100%" border="0" cellspacing="0" cellpadding="0" summary="top menu">
			<tr>
				<td width="10"><img src="art/menu_left.png" alt="[Top Main Menu]"></td>
				<td width="85" background="art/menu_border.png" align="center"><a class="menutext" href="intro_preface.html">Intro</a></td>
				<td background="art/menu_border.png" align="center"><span class="menutext">|</span></td>
				<td width="85" background="art/menu_border.png" align="center"><a class="menutext" href="tutorial_1.html">Tutorials</a></td>
				<td background="art/menu_border.png" align="center"><span class="menutext">|</span></td>
				<td width="85" background="art/menu_border.png" align="center"><a class="menutext" href="ref_adascript.html"><b>Reference</b></a></td>
				<td background="art/menu_border.png" align="center"><span class="menutext">|</span></td>
				<td width="85" background="art/menu_border.png" align="center"><a class="menutext" href="packages.html">Packages</a></td>
				<td background="art/menu_border.png" align="center"><span class="menutext">|</span></td>
				<td width="85" background="art/menu_border.png" align="center"><a class="menutext" href="../examples/index.html">Examples</a></td>
				<td background="art/menu_border.png" align="center"><span class="menutext">|</span></td>
				<td width="85" background="art/menu_border.png" align="center"><a class="menutext" href="cont_vision.html">Contributors</a></td>
				<td background="art/menu_border.png" align="center">&nbsp;</td>
				<td background="art/menu_border.png" align="right"><a href="ref_extcmds.html"><img src="art/left_arrow.png" width="27" height="24" alt="[Back Page]" border="0"></a><span class="menutext">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="ref_sockets.html"><img src="art/right_arrow.png" width="27" height="24" alt="[Next Page]" border="0"></a></td>
				<td background="art/menu_border.png">&nbsp;</td>
</tr></table></td></tr>
	</table>
	<noscript>
	<a href="#submenu">[Jump to Submenu]</a>
	<hr />
	</noscript>
	<table width="100%" border="0" cellspacing="0" cellpadding="0" summary="content and right submenu">
		<tr>
			<td align="left" valign="top">
	<!-- Content Area -->
<h2><a name="3.23"></a>Block Statements and Subprograms</h2>

<p>SparForte scripts can be organized using declare blocks, procedures and
functions.  This enables pieces of a program to be easily reused.
A procedure is a routine that can be called but returns no value.
For example, <tt>put_line</tt> is a procedure.  A function always
returns a value so it can be used as part of an expression.
<tt>strings.length</tt> is an example of a function which responds
with the length of a string.</p>

<h3>Overall Structure</h3>

<p>An AdaScript script consists of a sequence of executable statements.
These statements can appear as a simple list or can be enclosed in
a "library" unit.  The basic library unit is a main procedure (or
sometimes called a main program or main subprogram).  Other library
units may be introduced in the future (such as packages).</p>

<p>If <tt>pragma ada_95</tt> is used, the statements must be enclosed in a
library unit.</p>

<p>Some features may not be available with a simple list of
statements.</p>

<h3>Declare Block</h3>

<p>Declare blocks (also called block statements) contains a sequence of
statements or commands that can include locally declared variables.
Declare blocks are located in the executable part
of a script.  Between <tt>declare</tt> and <tt>begin</tt>, declarations can be made.
Between <tt>begin</tt> and <tt>end</tt> are executable statements.  The declarations
are visible to these executable statements.</p>

<p>A new block can be created without declaration any
variables by using begin...end without the declare section.<br>
</p>

        <center>
        <div class="code">
                <p class="code">
<b>declare</b><br>
&nbsp;&nbsp; i : integer := 5;<br>
<b>begin</b><br>
&nbsp;&nbsp; ? i;<br>
<b>end;</b><br>&nbsp;<br></p>
        <div class="code_caption">
                <b>Example</b>: The Declare Block Statement
        </div>
        </div>
        </center>

<h3>Procedure and Function Blocks</h3>

<p>Repeatable blocks of a series of instructions (like Perl sub or Python def) can
be created with the word <tt>procedure</tt> or <tt>function</tt>.&nbsp; A procedure is a
set of instructions with a name.&nbsp; A function is a set of
instructions with a name that computes and returns a value and can be
used in an expression.&nbsp; Like a declare block, local variables can
be declared
before the word <tt>begin</tt>.  Procedure and function subprograms
must finish with <tt>end</tt> and the name of the subprogram: this is
to clarify the structure of the program.</p>

<p><b>Ada</b>: In Ada, the name of the subprogram is optional after
<tt>end</tt>.  In AdaScript, the name is required.</p>

        <center>
        <div class="code">
                <p class="code">
<b>procedure</b> print_title <b>is</b><br>
<b>begin</b><br>
&nbsp;&nbsp; put_line( "Script to Process New Orders" );<br>
&nbsp;&nbsp; new_line;<br>
<b>end</b> print_title;
<br>&nbsp;<br></p>
        <div class="code_caption">
                <b>Example</b>: The Procedure Subprogram Statement
        </div>
        </div>
        </center>

<p>Procedures and functions may be nested: you can declare them in the
declaration parts of another procedure, function or declare block.
These nested subprograms only exist for the scope of this parent
block.</p>

<p><b>Ada</b>: AdaScript doesn't support creating new arithmetic
operators by defining functions with operator symbols.</p>

<h3>The Return Statement</h3>

<p>A procedure may be terminated early using a <tt>return</tt>
statement.  A function uses <tt>return</tt> to return back a
value.</p>

<p>A <tt>return</tt> statement may contain an optional <b>when</b> clause, similar
to a loop <tt>exit</tt> statement.  The main advantage of the <tt>when</tt> clause over an
<tt>if</tt> statement is to execution jumps in the source code more obvious.</p>

<h3>Procedure and Function Parameters</h3>

<p>Both procedures and functions can have parameters.&nbsp;  If a
procedure or function has no parameters, do not include any
parentheses.  If there are parameters, they are listed with
a name, a mode and a type.  By default, all parameters are "in" mode
parameters: they give additional information to a subprogram
and are treated as constants.&nbsp; The word "in" is optional
before the type of parameter.</p>

        <center>
        <div class="code">
                <p class="code">
<b>function</b> add_two( number : integer ) <b>return</b> integer <b>is</b><br>
<b>begin</b><br>
&nbsp; <b>return</b> number+2;<br>
<b>end</b> add_two;<br>
<br>&nbsp;<br></p>
        <div class="code_caption">
                <b>Example</b>: The Function Subprogram Statement
        </div>
        </div>
        </center>

<p>Besides in mode parameters, parameters may also be <b>out</b> or <b>in out</b> mode.  Out parameters return values, and in out read, modify and return values.  These parameters may refer to arrays, records, array elements or record fields, in addition to the scalar types.</p>

<p>Functions are not allowed to use out parameters.</p>

<p><b>Ada</b>: Ada does not permit functions to use in out mode parameters.</p>

<p>Procedures and functions can only declared inside the declaration section of
a script's main procedure block (or declared nested inside other subprograms
or declare blocks).</p>

        <center>
        <div class="code">
                <p class="code"><b>procedure</b> my_script <b>is</b><br>
     <b>procedure</b> my_proc <b>is</b> -- OK<br>
  ...<br>
  <b>end</b> my_script;
<br>&nbsp;<br></p>
        <div class="code_caption">
                <b>Example</b>: A Main Program Procedure
        </div>
        </div>
        </center>

<p>That is, they must be in a script that has a main procedure block.</p>

        <center>
        <div class="code">
                <p class="code">
  i : integer;<br>
  i := 5;<br>
  <b>procedure</b> my_proc <b>is</b> -- BAD...use a main procedure block<br>
  ...
</p>
        </div>
        </center>

<p>The built-in procedures and functions found in the SparForte
packages may include parameters with other modes.  <tt>in out</tt> mode
means the value of the parameter is used by the subprogram and
may be changed.  <tt>out</tt> mode means the parameter is not read by
the subprogram but a value will be returned using the parameter.
Functions may only use in mode.  The modes are described on the front
page of the <b>Packages</b> section of this documentation.</p>

<p><b>Ada</b>: <tt>access</tt>
mode parameters are not supported for user-defined subprograms.
Named parameters are not supported.  Default values are not
supported.</p>

<h3>Subprogram Specifications and Mutual Recurson</h3>

<p>Introduced in SparForte 2.3</p>

<p>A subprogram <b>specification</b> is an incomplete description
of a procedure or
function that will be fully described later.  This is like entries in
a table of contents in a book which shows upcoming chapters that
will appear later in the book.  Each line in the table of contents
is a specification for the chapter.  Later the chapter will be
implemented and can be read.  (Different programming languages
use different names for specifications, such as C header file
declarations or Pascal forward declarations.)</p>

<p>A specification is the start of a procedure (or function) up
to the word "is", at which point you use a semi-colon to end the
function prematurely.</p>

        <center>
        <div class="code">
                <p class="code"><b>procedure</b> show_report<b>;</b><br>
<br>&nbsp;<br></p>
        <div class="code_caption">
                <b>Example</b>: A Procedure Specification
        </div>
        </div>
        </center>

<p>SparForte will expect the full procedure to appear later in the
same block of code.</p>

        <center>
        <div class="code">
                <p class="code"><b>procedure</b> show_report <b>is</b><br>
<b>begin</b><br>
&nbsp;&nbsp;put_line( "This is the report" );<br>
<b>end</b> show_report;<br>
<br>&nbsp;<br></p>
        <div class="code_caption">
                <b>Example</b>: The Earlier Specification Implemented
        </div>
        </div>
        </center>

<p>SparForte will expect the full procedure to appear later in the
same block of code.  That is, the specification must be implemented.</p>

<p>A specification must match the implementation: the parameter
names, parameter modes, parameter types and any return value should
be identical.  For example, you cannot change the parameter names or add extra
parameters.</p>

        <center>
        <div class="code">
                <p class="code"><b>procedure</b> show_report( title : string )<b>;</b><br>
...<br>
<b>procedure</b> show_report( title : string ) <b>is</b><br>
<b>begin</b><br>
&nbsp;&nbsp;put_line( "This is the report" );<br>
<b>end</b> show_report;<br>
<br>&nbsp;<br></p>
        <div class="code_caption">
                <b>Example</b>: A Specification with a Parameter
        </div>
        </div>
        </center>


<p>Specifications have many uses.  One problem they help with is
<b>mutual recursion</b>, where two subprograms use each other.  Without
specifications, it is not possible to declare these subprograms.
SparForte reads your script from the beginning to the end, and
what you use must be declared before you use it.  With two
subprograms that use each other, they both need to be declared
before either can be used.  Specifications solve this.</p>

        <center>
        <div class="code">
                <p class="code"><b>procedure</b> first<b>;</b><br>
<b>procedure</b> second<b>;</b><br>
&nbsp;<br>
<b>procedure</b> first <b>is</b><br>
<b>begin</b><br>
&nbsp;&nbsp;second;<br>
&nbsp;&nbsp;...<br>
<b>end</b> first;<br>
<b>procedure</b> second <b>is</b><br>
<b>begin</b><br>
&nbsp;&nbsp;first;<br>
&nbsp;&nbsp;...<br>
<b>end</b> second;<br>
<br>&nbsp;<br></p>
        <div class="code_caption">
                <b>Example</b>: Mutual Recursion
        </div>
        </div>
        </center>

<p>SparForte will expect the full procedure to appear later in the
same block of code.  That is, the specification must be implemented.</p>

<p>Another use is specifying a list of public subprograms in a
file, like you would a table of contents from a book in the earlier
example.</p>

<h3>Separate Subprograms</h3>

<p>Procedures and functions maybe loaded from a separate file.
(This is referred to as a "subunit": a feature of a script stored
in a separate file).</p>

<p>Copy your subprogram (or create a new one) and put it in a file
with the name of the subprogram.  For example, if you have a
separate procedure called "t2", put it in a file called "t2.sp".
The filename must match the name of the subprogram.</p>

<p>Separate subprograms must begin with a <tt>separate</tt> statement as
the first line in the file.  This indicates that the file is not
an executable script.  The separate statement should include
the name of the parent script.  Each separate subprogram belongs
to a single, specific parent script.</p>


        <center>
        <div class="code">
        <p class="code">
        -- t2.sp is a separate procedure<br>
	<b>separate</b>( t );<br>
        <b>procedure</b> t2 <b>is</b><br>
        <b>begin</b><br>
        &nbsp;&nbsp;put_line( "t2 was called!" );<br>
        <b>end</b> t2;<br>&nbsp;<br>
        <div class="code_caption">
                <b>Example</b>: t2.sp is a loadable by a script named t.sp
        </div>
        </div>
        </center>

<p>In the parent script (the one that will load the subprogram),
declare the subprogram but replace the body of the subprogram
with the word <tt>separate</tt>.</p>

        <center>
        <div class="code">
        <p class="code">
	<b>procedure</b> t <b>is</b><br>
        &nbsp;&nbsp;<b>procedure</b> t2 <b>is</b> <b>separate</b>;<br>
        <b>begin</b><br>
        &nbsp;&nbsp;t2;<br>
        <b>end</b> t;<br>&nbsp;<br>
        <div class="code_caption">
                <b>Example</b>: t.sp loads t2.sp and executes t2
        </div>
        </div>
        </center>

<p>SparForte will search for the separate subprogram using the SparForte
library path.  The path is specified using the <b>-L</b> command option or using
the environment variable <b>SPAR_LIBRARY_PATH</b>.  By default, SparForte
will search the current directory.  The separate subprogram must exist and
be readable in order to load it.</p>

<p>In SparForte, procedures and functions can be nested.  Support for
separate nested subprograms is planned but not yet implemented.</p>

<p>Separate subprogram blocks are similar to include files in other
languages except that the separate block is a part of a specific main
script.</p>

<p><b>Ada</b>: GCC Ada also has separate subunits.  They are implemented
in the same way.</p>

<h3>Separate Declarations</h3>

<p>A separate declaration file is the SparForte equivalent of an include
file.  It is an set of declaration statements stored in a separate file.
The file
can include variables, constants, types, functions, procedures, pragmas,
etc.  A declaration file is used to share common declarations across
many scripts.</p>

<p>The separate declaration file is inserted into another script using "with separate".
Since the declaration file is inserted, they have the same scope as the declaration
block they are used in.  Any subscript pragmas will also affect
the file loading the declaration file.  The with separate statement can occur in
a declaration section of any block (a main procedure, procedures, functions
or a declare block).</p>

        <center>
        <div class="code">
        <p class="code">
        <b>procedure</b> main <b>is</b><br>
	&nbsp;&nbsp;<b>with</b> <b>separate</b> "globals.sp";<br>
        <b>begin</b><br>
        &nbsp;&nbsp;? company_name; -- displays "PegaSoft"<br>
        <b>end</b> main;<br>&nbsp;<br>
        <div class="code_caption">
                <b>Example</b>: Loading a separate declaration file
        </div>
        </div>
        </center>

<p>Unlike separate procedures / functions, declaration files are not tied to
a particular script.  The subscript fragment must have "separate" as its
first statement.  This identifies it as a separate declaration file.</p>

        <center>
        <div class="code">
        <p class="code">
        -- This is the file named globals.sp<br>
	<b>separate</b>;<br>
        company_name : <b>constant</b> string := "PegaSoft";<br>&nbsp;<br>
        <div class="code_caption">
                <b>Example</b>: A very short separate declaration file containing one constant
        </div>
        </div>
        </center>

<p>Like separate subprograms, SparForte will search for the declaration file
using the SparForte library path. The path is specified using the <b>-L</b> command
option or using the environment variable <b>SPAR_LIBRARY_PATH</b>. By default,
SparForte will search the current directory. The declaration file must
exist and be readable in order to load it.</p>

<p>The separate declaration file may contain more "with separate" statements.  If the same
file is included twice in the same scope, duplicate declaration errors will
occur.  Having a file include itself, or having a nested with separate include
the file, will result in a loop and SparForte will report an error.</p>

<p>Subscripts are loaded before a script starts execution.  If you do something
unusual such as to create a
for loop containing a declare block with a "with separate", the with separate
only executes once.  However, the subprograms contained in the separate
declaration file will
access the new variable values as the for loop iterates, just as if they were
declared without the with separate.</p>

<p>Subscripts are permitted with pragma ada_95, even though they are not a part
of the Ada 95 standard, to allow large scripts to be broken up.</p>

<p>Subscripts are permitted in a restricted shell to allow large scripts to
be broken up.</p>

<p><b>Implementation Note</b>: with separate has a string literal as a parameter.  Because
the separate file is loaded before the program is running, any variables that might
contain the file path cannot exist when the file is loaded.  So you're stuck
with a string literal.</p>

<p><b>Rationale</b>: Subscripts are intended as a simple mechanism to
break up large scripts until loadable user-defined packages are completed.</p>

<h3>Abstract Procedures and Functions</h3>

<p>Abstract procedures and functions are subprograms that can be defined
but not run.  They might be abstract because they are incomplete prototypes.</p>

<p>They are created by including the word <b>abstract</b> after the word
<b>is</b>.</p>

<p>A <b>null abstract</b> subprogram is one without a body</p>

        <center>
        <div class="code">
        <p class="code">
	<b>procedure</b> unfinished <b>is</b> <b>null</b> <b>abstract</b>;<br>&nbsp;<br>
        <div class="code_caption">
                <b>Example</b>: A null abstract procedure
        </div>
        </div>
        </center>


<h3>Exceptions</h3>

<p>Procedures, functions, declare blocks or main programs can have an
exception handler.  If an error or exception occurs, you can detect it
and perform remedial action in the handler.</p>

<h4>Declaring Exceptions</h4>

<p>Exceptions can be declared by creating variables with the type
of <b>exception</b>.  They are not intended for reporting all errors,
but errors that are rare or inconvenient to test for in the middle
of a routine.</p>

        <center>
        <div class="code">
        <p class="code">
	file_load_error : <b>exception</b>;<br>&nbsp;<br>
        <div class="code_caption">
                <b>Example</b>: An exception declaration
        </div>
        </div>
        </center>

<p>The exception type name may be followed with a "with/use".  <b>with</b>
specifies a default message to accompany the exception error message.
<b>use</b> specifies a status code to return if the exception is raised to
the main program and is not handled.</p>

        <center>
        <div class="code">
        <p class="code">
	file_load_error : <b>exception</b> <b>with</b> "unable to load the file" <b>use</b> 15;<br>&nbsp;<br>
        <div class="code_caption">
                <b>Example</b>: An exception declaration with a with/use clause
        </div>
        </div>
        </center>

<p>The with/use clause is not available with pragma ada_95.</p>

<p>Unlike other variables, two exceptions with the same name declared in
overlapping scopes are not allowed.  This is to make it easier to
identify which exception was raised.  For example, if you had a global
exception named "disk_space_error" you cannot declare another
"disk_space_error" in a procedure.</p>

<p><b>Ada</b>: Ada permits exceptions with the same name in overlapping
scopes.  It differentiates between them with dotted notation.</p>

<h4>Exception Handlers</h4>

<p>Exception handlers are created using an <b>exception</b> section.  Once
an exception handle runs, control is not returned to the block where the
exception occurred: the exception handler replaces the remainder of the
executable statements in the block.</p>

<p>An exception handler is similar to a <b>case</b> statement.  <b>when</b>
sections contain the executable code to run in the case of a specific exception.</p>

<p>If there is a <b>when</b> <b>others</b> section, it will run if none of the
preceding sections applied.  <b>when</b> <b>others</b> will also handle most
run-time errors.</p>

        <center>
        <div class="code">
        <p class="code">
        <b>procedure</b> divide( x : integer; y : integer ) <b>is</b><br />
        <b>begin</b><br />
        &nbsp;&nbsp;put_line( x / y );<br />
        <b>exception</b> <b>when</b> <b>others</b> =&gt;<br />
        &nbsp;&nbsp;put_line( "undefined" );<br />
        <b>end</b> divide;<br />&nbsp;<br />
        <div class="code_caption">
                <b>Example</b>: Math errors like dividing by zero display "undefined"
        </div>
        </div>
        </center>

<p>Errors that occur during the syntax check when a program starts
cannot be handled as the program is not running yet.  A small number
of errors, such as exceeding the number of variables the language
can declare, cannot be handled, mainly because the run-time system
is in a corrupted or uncertain state.</p>

<p>If an exception handler occurs in a function, a function return can
be placed in the handler.</p>

<p>If a block has no exception handler, the enclosing blocks will be
searched for a handler.  (That is, the exception will propagate.)</p>

<p>An exception handler can contain a declare/begin block with its own
exception handlers.</p>

<h4>Re-raising Exceptions</h4>

<p>The <b>raise</b> command will propagate the exception after handling.
That is, it will
reinstate the exception to exception handlers in the surrounding blocks, just
as if the exception was not handled.</p>

        <center>
        <div class="code">
        <p class="code">
        <b>procedure</b> main_prog <b>is</b><br />&nbsp;<br />
        &nbsp;&nbsp;<b>procedure</b> divide( x : integer; y : integer ) <b>is</b><br />
        &nbsp;&nbsp;<b>begin</b><br />
        &nbsp;&nbsp;&nbsp;&nbsp;put_line( x / y );<br />
        &nbsp;&nbsp;<b>exception</b> <b>when</b> <b>others</b> =&gt;<br />
        &nbsp;&nbsp;&nbsp;&nbsp;put_line( "undefined" );<br />
        &nbsp;&nbsp;&nbsp;&nbsp;<b>raise</b>;<br />
        &nbsp;&nbsp;<b>end</b> divide;<br />&nbsp;<br />
        <b>begin</b><br />
        &nbsp;&nbsp;? divide( 2, 0 );<br />
        <b>exception</b> <b>when</b> <b>others</b> =&gt;<br />
        &nbsp;&nbsp;put_line( standard_error, "an exception occurred" );<br />
        <b>end</b> main_prog;<br />&nbsp;<br />
        <div class="code_caption">
                <b>Example</b>: Both exception handlers will run
        </div>
        </div>
        </center>

<h4>Raising New Exceptions</h4>

<p>The <b>raise</b> command will raise user-declared exceptions.</p>

        <center>
        <div class="code">
        <p class="code">
file_load_error : <b>exception</b>;<br>
...<br>
<b>raise</b> file_load_error;<br>&nbsp;<br>
        <div class="code_caption">
                <b>Example</b>: A basic raise statement
        </div>
        </div>
        </center>

<p>An alternate message can be given with a <b>with</b> clause.</p>

        <center>
        <div class="code">
        <p class="code">
	<b>raise</b> file_load_error <b>with</b> "the customer file did not load";<br>&nbsp;<br>
        <div class="code_caption">
                <b>Example</b>: A raise with a custom message
        </div>
        </div>
        </center>

<p>A raise can be conditional when a <b>when</b> clause is added.  The main
advantage of the when clause, over an if statement, is that it makes
execution jumps more visible in the source code.</p>

        <center>
        <div class="code">
        <p class="code">
file_length_error : <b>exception</b>;<br>
...<br>
<b>raise</b> file_load_error <b>when</b> strings.length( file_contents ) = 0;<br>&nbsp;<br>
        <div class="code_caption">
                <b>Example</b>: A conditional raise statement with a custom message
        </div>
        </div>
        </center>


<p><b>raise</b> can be used within an exception handler to raise a different
exception.</p>

<p><b>Ada 95</b>: A raise when clause and with clause are not allowed with pragma ada_95.</p>

<h2>Profile Files</h2>

<p>When SparForte is used as a login shell, it checks for the existence
of two files: "/etc/sparforte_profile" and ".sparforte_profile" in the
user's home directory.  The first is a system-wide initialization file.   
The second is for initializing personal preferences.  The personal file 
always run after the system-wide file.  These are only read on login, or 
if SparForte simulates a login when it is started with <tt>--login</tt>.</p>

<p>SparForte checks these files before opening them.  They must meet the
following conditions:</p>

<ul>
<li>They must be regular files (that is, not a directory or other special-purpose file)</li>
<li>The file permissions must allow the files to be read by the user</li>
<li>The file permissions must not allow others to write to the files (for security purposes)</li>
<li>They must not be empty</li>
</ul>

<p>If a profile exists but doesn't meet these conditions, an error is
reported and the profile file will not be run.  The login session will
be aborted.</p>

<p>For multiple local profile files in one home directory, use the
<tt>--session</tt> option to give each file a different name in the form
of ".sparforte_<i>session_name</i>_profile.  Each session will also have
a different shell history file.</p>

<h2>Policies and the Global Policy File</h2>

<p>A <b>policy</b> is a special block.  It contains a collection of
pragmas that apply to a project.  It may also contain static if or case
statements (that is, with expressions that can be evaluated before the
program is run) so that different pragmas can be applied in different
situations.  They are intended for use by architects.</p>

<p>Policy blocks are named so that each block can be applied only once.
An identifier already declared error will occur if the same block is
applied twice.</p>

<p>A policy block should appear before the main program.</p>

        <center>
        <div class="code">
        <p class="code"><b>policy</b> web_app_policy <b>is</b><br>
        &nbsp;&nbsp;<b>pragma</b> ada_95;<br>
        &nbsp;&nbsp;<b>if</b> <b>not</b> System.Development_Phase <b>then</b><br>
        &nbsp;&nbsp;&nbsp;&nbsp;<b>pragma</b> restriction( no_external_commands );<br>
        &nbsp;&nbsp;<b>end</b> <b>if</b>;<br>
        <b>end</b> web_app_policy;<br>&nbsp;<br>
        </p>
        <div class="code_caption">
        <b>Example</b>: A Simple Policy Block</span>
        </div>
        </div>
        </center>

<p>There can also be a global policy file.  When SparForte runs a script,
it searches for a file called <span class="code">/etc/sparforte_policy</span>.  This is a system-wide initialization
file, similar to a profile file.  It's purpose is to setup any architectural
pragmas common to all scripts
on a server.  The policy file is not executed for interactive sessions.
The file is intended to be used by architects who maintain the standards
and integration of different computer systems, separating their concerns
from those of the programmers.</p>

<p>SparForte checks this file before opening it.  It must meet the
following conditions:</p>

<ul>
<li>It must be a regular file (that is, not a directory or other special-purpose file)</li>
<li>The file permissions must allow the file to be read by the user</li>
<li>The file permissions must not allow others to write to the file (for security purposes)</li>
<li>It must not be empty</li>
</ul>

<p>If a policy file exists but doesn't meet these conditions, an error is
reported and the file will not be run.  The script will be aborted.</p>

<p>A policy file may only contain <b>pragma</b>'s.  It cannot contain
include files.</p>

<h2>Configuration Blocks and Global Configuration File</h2>

<p>A <b>configuration</b> block is a special block.  It contains a
collection of declarations and pragmas at apply to a project.  These
are for describing environment settings such as server names,
login credentials for services (such as databases) and so forth.
The block is intended for use by system administrators.</p>

<p>Configuration blocks are named so that each block can be applied only once.
An identifier already declared error will occur if the same block is
applied twice.</p>

<p>A configuration block should appear before the main program.</p>

<p>There can also be a global configuration file.
After running any global policy file, SparForte searches for a file called
<span class="code">/etc/sparforte_config</span>.  This is a system-wide initialization file
containing a configuration block.
The configuration file is not executed for interactive sessions.  The
file is intended to be used by system administrators who must maintain
different environments, separating their concerns from those of the
programmers.</p>

<p>SparForte checks this file before opening it.  It must meet the
following conditions:</p>

<ul>
<li>It must be a regular file (that is, not a directory or other special-purpose file)</li>
<li>The file permissions must allow the file to be read by the user</li>
<li>The file permissions must not allow others to write to the file (for security purposes)</li>
<li>It must not be empty</li>
</ul>

<p>If a configuration file exists but doesn't meet these conditions, an error is
reported and the file will not be run.  The script will be aborted.</p>

<p>A configuration file may only contain declarations.  That is, it may contain
variable declarations, constant declarations, type declarations, pragmas,
function declarations or procedure declarations&mdash;anything which can be
created in the declaration section of a subprogram.  However, the content
is mostly likely to be a group of constants.  It cannot contain include
files.</p>

        <center>
        <div class="code">
        <p class="code">-- Database settings for this server<br>
        <b>configuration</b> dev_environment <b>is</b><br>
        &nbsp;&nbsp;db_host     : <b>constant</b> string := "db1.ourcompany.com";<br>
        &nbsp;&nbsp;db_username : <b>constant</b> string := "webapp";<br>
        &nbsp;&nbsp;db_password : <b>constant</b> string := "secret";<br>
        <b>end</b> dev_environment;<br>&nbsp;<br>
        </p>
        <div class="code_caption">
        <b>Example</b>: A Simple /etc/sparforte_config File</span>
        </div>
        </div>
        </center>

<p>SparForte will not report an error if there are any unused variables from
the configuration file.   It is assumed that some declarations will not be
used in some scripts.</p>

<h2>Side-Effects and Data Safety</h2>

<p>SparForte does not permit certain combinations of statements that may
have risky or unpredictable consequences.</p>

<p>A <b>volatile</b> variable is any variable that has a value that can
change unexpectedly.  Volatile variables are a problem in expressions
because the value of a variable could change while tn expression is being
calculated.</p>

<p>One way a variable can be volatile is by designating one volatile with
<b>pragma volatile</b>.  For an imported variable, pragma volatile will
cause the variable's value to be re-imported every time the variable is
read.  There is no guarantee in an expression like "x + x that both
occurrences of x will have the same value.  Any variable can be designated
volatile, even if it isn't imported.  It is an error to use volatile
variables in an expression.</p>

<p>Variables can also be volatile if their values are changed during an
expression by a <b>function</b> called in the same expression.  In this
case, it is made more complex because of the order of operations.  By
changing the operations in an expression, the order of the computations
are changed, and this can change when a function is run.  This
unpredictability can make debugging difficult.</p>

<p>This can happen not only in the function itself, but in other
procedures and functions run by the original function.</p>

<p>To deal with volatile variables, SparForte detects three different
types of risky actions in expressions: write then read, read then write
and write then write.</p>

<p><b>Write then Read</b></p>

<p>A function (or anything run by a function) must not change a variable's
value when that value is also read later in the expression.</p>

        <center>
        <div class="code">
        <p class="code"><b>procedure</b> side_effect <b>is</b><br>
&nbsp;&nbsp;i : integer := 5;<br>
<br>
&nbsp;&nbsp;<b>function</b> risky <b>return</b> integer <b>is</b><br>
&nbsp;&nbsp;<b>begin</b><br>
&nbsp;&nbsp;&nbsp;&nbsp;i := 10;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<b>return</b> 1;<br>
&nbsp;&nbsp;<b>end</b> risky;<br>
<br>
<b>begin</b><br>
&nbsp;&nbsp;? i * risky + i; -- changing i during an expression<br>
<b>end</b> side_effect;<br>&nbsp;<br>
</p>
        <div class="code_caption">
        <b>Example</b>: An expression side-effect
        </div>
        </div>
        </center>

<p>i is not volatile but it should be volatile.  This will cause the following error:</p>

<div class="code">
<p class="code">
&nbsp;&nbsp;? i * risky + i;  -- changing i during an expression
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^ side-effects: i was read after written within an expression.  Perhaps a copy should be used.
</p>
</div>

<p>To avoid this message, declare a new variable using the <b>copies</b> clause to
get a value in a moment of time, and use the copy in the expression.</p>

<p>With arrays and records, writing to an array element or any record field will
cause the entire array or record to be treated as volatile.</p>

<p><b>Read then Write</b></p>

<p>The reverse case is to read a variable first, then a function changes it
aftewards in an expression.  Technically, this is not a side-effect because
the variable's value isn't affected by the function.  However, it is treated
as a side-effect because if the math changes in the expression and the
expression is evaluated in a different order, it could become one.</p>

<div class="code">
<p class="code">
side-effects: i was written after read within an expression.  Perhaps a copy should be used.
</p>
</div>

<p>To solve these errors, use a copy of the original variable.</p>

<p>This particular check is expensive and tests for a potential problem,
so SparForte does not run this check in maintenace mode.</p>

<p><b>Write then Write</b></p>

<p>Two different functions (or a function and the main program, or a
function and a contract) in an expression are not allowed to write to the
same variable.
Only one function may write to a variable in a more global scope.  This is
done to prevent data races, where two functions in an expression compete
to update the same variable first.  Instead, only one function
is responsible for updating the value.</p>

<p>For any global variable, any function can change a global variable.  However,
only that function and no other function can change that variable.</p>

<p>In this case, there error will be like this example:</p>

<div class="code">
<p class="code">
side-effects: i (in func1) is not unchecked_volatile but is also changed by func2.  Perhaps refactor so one source is a procedure or break up the expression.
</p>
</div>

<p>The solution is to change one function into a procedure, or to
break the expression into two separate statements.</p>

<p><b>pragma unchecked_volatile</b></p>

<p>There may be certain cases where "write then write" is the intended
behaviour.  One example would be creating a log of the functions
where each function writes an entry to the log when it runs.  In this case,
you can declare the variable as an unchecked volatile using
<b>pragma unchecked_volatile</b>.  SparForte will ignore "write then
write" tests, but will still do "write then read" and "read then
write" tests.</p>

<p>An unchecked volatile variable can also be used in expressions.</p>

<p>Declaring volatile and unchecked_volatile variables can be disabled
entirely with <b>pragma restriction</b>.  See the pragma section for
more information.</p>

<br>&nbsp;

			</td>
			<td bgcolor="#d3c7f8" width="150" align="right" valign="top"><noscript><hr /></noscript><img src="art/right_menu_top.png" width="150" height="24" alt="[Right Submenu]"><br><a name="submenu"></a>
                                <p class="rmt"><a class="rightmenutext" href="ref_adascript.html">&nbsp;AdaScript versus GCC</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_case.html">&nbsp;Case Sensitivity</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_reserved.html">&nbsp;Reserved Words</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_comments.html">&nbsp;Comments</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_literals.html">&nbsp;Literals</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_shellargs.html">&nbsp;Bourne Shell Word Expansions</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_types.html">&nbsp;Fundamental Types</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_typedecl.html">&nbsp;User-defined Types</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_enum.html">&nbsp;Enumerated Types</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_arrays.html">&nbsp;Arrays</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_records.html">&nbsp;Records</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_assign.html">&nbsp;Basic Assignment</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_specials.html">&nbsp;The @ and % Operands</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_cmdlineargs.html">&nbsp;Command Argument Shortcuts</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_redirection.html">&nbsp;Redirection and Pipelines</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_cmdline.html">&nbsp;Command Line Interaction</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_shellcmds.html">&nbsp;Built-in Shell Commands</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_cd.html">&nbsp;The Current Directory</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_db.html">&nbsp;Database Commands</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_flow.html">&nbsp;Ifs and Loops</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_other.html">&nbsp;Other Statements/ Subprograms</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_extcmds.html">&nbsp;External Commands</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_subprograms.html">&nbsp;<b>Block Statements and Subprograms</b></a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_sockets.html">&nbsp;TCP/IP Sockets</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_numberformat.html">&nbsp;Numeric Formatting with Put</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_pragmas.html">&nbsp;Interpreter Directives</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_cmdoptions.html">&nbsp;Command Line Options</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_cmdref.html">&nbsp;Command Reference</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_charsets.html">&nbsp;ASCII and Latin_1 Character Sets</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_errors.html">&nbsp;Common Error Messages</a></p>
                                <p class="rmt"><a class="rightmenutext" href="ref_php.html">&nbsp;Common PHP Functions and the SparForte Equivalent</a></p>
			</td>

		</tr>
		<tr>
			<td bgcolor="#d3c7f8" align="left" valign="middle"><a href="#top"><img src="art/up_arrow.png" border="0" width="24" height="27" alt="[Back to Top]"><span>&nbsp;Back To Top</span></a></td>
			<td bgcolor="#d3c7f8" align="center" valign="middle"><img src="art/forte_small.png" width="26" height="32" border="0" alt="[Small Forte Symbol]"></td>
	       	</tr>

	</table>

</body>
</html>
